<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="1132" height="804" xmlns:ev="http://www.w3.org/2001/xml-events" viewBox="0 0 1132 804"><style type="text/css"><![CDATA[
.st1 {fill:#0070c0;font-family:宋体;font-size:14pt}
.st2 {fill:#118972;font-family:宋体;font-size:14pt}
.st4 {fill:#16a58a;font-family:宋体;font-size:14pt}
.st5 {fill:#191919;font-family:宋体;font-size:14pt}
.st3 {fill:#1f6391;font-family:宋体;font-size:14pt}
.st6 {fill:#ff0000;font-family:宋体;font-size:12pt;font-weight:bold}
]]></style><defs/><g id="page1" transform="translate(5,5)"><rect stroke="#808080" width="1123" fill="#ffffff" height="794" x="0" y="0"/><g transform="translate(38,47)"><g><g transform="translate(85,175)"><path id="shape1" d="M0,0L331,0" stroke="#118972" stroke-width="1.33333" fill="none" transform="matrix(0,1,-1,0,142,57)"/><path id="shape2" d="M0,0L331,0" stroke="#118972" stroke-width="1.33333" fill="none" transform="matrix(0,1,-1,0,610,61)"/><g id="shape3" transform="matrix(0.99,0.12,-0.12,0.99,142,109)"><path d="M0,0L461.9,0" stroke="#236ea1" stroke-width="2.66667" fill="none"/><path d="M471.5,0L460.1,-6.5C461.3,-4.6,461.9,-2.4,461.9,0C461.9,2.4,461.3,4.6,460.1,6.5L471.5,0" stroke="#236ea1" stroke-width="1" fill="#236ea1" stroke-linecap="round"/></g><g id="shape4" transform="matrix(-0.99,0.13,-0.13,-0.99,610,194)"><path d="M0,0L462.4,0" stroke="#236ea1" stroke-width="2.66667" fill="none"/><path d="M472,0L460.6,-6.5C461.8,-4.6,462.4,-2.4,462.4,0C462.4,2.4,461.8,4.6,460.6,6.5L472,0" stroke="#236ea1" stroke-width="1" fill="#236ea1" stroke-linecap="round"/></g><g id="shape5" transform="matrix(0.99,0.12,-0.12,0.99,142,298)"><path d="M0,0L461.9,0" stroke="#236ea1" stroke-width="2.66667" fill="none"/><path d="M471.5,0L460.1,-6.5C461.3,-4.6,461.9,-2.4,461.9,0C461.9,2.4,461.3,4.6,460.1,6.5L471.5,0" stroke="#236ea1" stroke-width="1" fill="#236ea1" stroke-linecap="round"/></g><g id="shape6" transform="translate(85,0)"><text class="st1"><tspan x="31" y="48.5">客户</tspan></text></g><g id="shape7" transform="translate(555.5,0)"><text class="st1"><tspan x="21" y="48.5">服务器</tspan></text></g><g id="shape8" transform="translate(0,57)"><text class="st2"><tspan x="37" y="38">socket</tspan><tspan x="4" y="60">connect(阻塞)</tspan><tspan x="23" y="82">(主动打开)</tspan></text></g><g id="shape9" transform="translate(0,223)"><text class="st2"><tspan x="11" y="60">connect返回</tspan></text></g><g id="shape10" transform="translate(614,100)"><text class="st2"><tspan x="5" y="38">socket,bind,listen</tspan><tspan x="45" y="60">(被动打开)</tspan><tspan x="32" y="82">accept(阻塞)</tspan></text></g><g id="shape11" transform="translate(614,301)"><text class="st2"><tspan x="18" y="49">accept返回</tspan><tspan x="20" y="71">read(阻塞)</tspan></text></g><g id="shape12" transform="matrix(1,0.09,-0.09,1,274.7,71.8)"><text class="st3"><tspan x="80.5" y="43.7">SYN  J</tspan></text></g><g id="shape13" transform="matrix(0.99,-0.16,0.16,0.99,281.8,200.1)"><text class="st3"><tspan x="11.5" y="31">SYN K，ACK J+1</tspan></text></g><g id="shape14" transform="matrix(0.99,0.14,-0.14,0.99,328.1,281.7)"><text class="st3"><tspan x="59" y="28.5">ACK K+1</tspan></text></g></g><g id="shape15"><text class="st4"><tspan x="4" y="21">1.服务器必须准备好接受外来的连接。这通常可以通过调用socket、bind、listen这三个函数来完成，我们称之为被动打开</tspan><tspan x="4" y="43">(passive open)</tspan><tspan x="4" y="65">2.客户通常调用connect发起主动打开(active open)，这导致客户TCP发送一个SYN(同步)分节，他告诉服务器将在(待建</tspan><tspan x="4" y="87">立的)连接中发送的数	    据的初始序列号。通常SYN分节不携带数据，其所在IP数据报只含有一个IP首部、一个</tspan><tspan x="4" y="109">TCP首部及可能有的TCP选项</tspan><tspan x="4" y="131">3.服务器必须确认(ACK)客户的SYN，同时自己发送一个SYN分节，它含有服务器将在同一连接中发送的数据的初始序列</tspan><tspan x="4" y="153">号。服务器在单个分支     中发送SYN和对客户SYN的ACK(确认)</tspan><tspan x="4" y="175">4.客户必须确认服务器的SYN。</tspan><tspan x="4" y="197">这种交换至少需要3个分组，所以称之为三路握手()</tspan></text></g><g id="shape16" transform="translate(18,572)"><text class="st5"><tspan x="13" y="50.5">上图中给出的客户的初始序号为J，服务器的初始序号为K，ACK中的确认号是发送这个ACK的一端所期待的下一个序</tspan><tspan x="20" y="72.5">列号。因为SYN占据一个字节的序列号空间，所以每一个SYN的ACK中的确认号就是该SYN的初始序列号加1,类似</tspan><tspan x="223" y="94.5">的，每一个FIN(表示结束)的ACK中的确认号为该FIN的序列号加1</tspan></text></g></g><g id="shape17" transform="translate(269,567)"><text class="st6"><tspan x="105" y="30.5">图2-2 TCP的三路握手</tspan></text></g></g></g></svg>